<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kaiser Villa Guide</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --ocean:#3a9cbf;--ocean-deep:#1f7a9a;--ocean-light:#eaf6fa;
  --terra:#d4845a;--terra-light:#faf0e8;
  --sand:#f5ece0;--sand-dark:#ddd0bc;
  --olive:#6d8c5e;--olive-light:#edf3e8;
  --grape:#8b6baf;--grape-light:#f3edf8;
  --driftwood:#a89279;--driftwood-light:#f8f3ec;
  --white:#fdfaf6;--charcoal:#3a3530;--warm-gray:#7d756d;
  --beach-blue:#42a5c5;--restaurant-terra:#d4845a;
  --hike-green:#6d8c5e;--attraction-purple:#8b6baf;
  --sidebar-w:380px;
  --font-display:'Libre Baskerville',Georgia,serif;
  --font-body:'Outfit','Segoe UI',sans-serif;
}
html,body{height:100%;font-family:var(--font-body);background:var(--sand);color:var(--charcoal);overflow:hidden}

/* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
.app{display:flex;height:100vh;width:100vw;position:relative}
#map{flex:1;height:100%;z-index:1}

/* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
.sidebar{
  width:var(--sidebar-w);height:100%;background:var(--white);
  display:flex;flex-direction:column;z-index:1000;
  box-shadow:4px 0 30px rgba(0,0,0,.1);
  transition:transform .4s cubic-bezier(.4,0,.2,1);
  position:relative;overflow:hidden;
  border-right:3px solid var(--sand-dark);
}
.sidebar::before{
  content:'';position:absolute;bottom:0;left:0;right:0;height:120px;
  background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 120'%3E%3Cpath fill='%233a9cbf' fill-opacity='.05' d='M0,64L48,58.7C96,53,192,43,288,48C384,53,480,75,576,80C672,85,768,75,864,64C960,53,1056,43,1152,48C1248,53,1344,75,1392,85.3L1440,96L1440,120L0,120Z'/%3E%3C/svg%3E") no-repeat bottom;
  background-size:cover;pointer-events:none;opacity:.7;
}
.sidebar.collapsed{transform:translateX(calc(-1 * var(--sidebar-w)))}

.sidebar-header{
  padding:28px 24px 20px;
  background:linear-gradient(160deg,#f5ece0 0%,#efe3d0 50%,#e8d9c4 100%);
  color:var(--charcoal);position:relative;overflow:hidden;flex-shrink:0;
  border-bottom:3px solid var(--sand-dark);
}
.sidebar-header::after{
  content:'';position:absolute;bottom:0;left:0;right:0;height:3px;
  background:repeating-linear-gradient(90deg,var(--ocean) 0,var(--ocean) 8px,transparent 8px,transparent 14px);
  opacity:.4;
}
.sidebar-header h1{
  font-family:var(--font-display);font-size:1.5rem;font-weight:700;
  line-height:1.15;letter-spacing:-.01em;margin-bottom:6px;
  color:var(--ocean-deep);
}
.sidebar-header p{
  font-size:.82rem;color:var(--driftwood);line-height:1.4;font-weight:400;
}
.header-deco{
  position:absolute;top:10px;right:16px;font-size:2.2rem;opacity:.15;
  color:var(--ocean);
}

/* ‚îÄ‚îÄ FILTERS ‚îÄ‚îÄ */
.filters{
  display:flex;gap:6px;padding:14px 18px 12px;flex-wrap:wrap;flex-shrink:0;
  border-bottom:2px dashed var(--sand-dark);
  background:var(--driftwood-light);
}
.filter-btn{
  border:2px solid var(--sand-dark);padding:7px 14px;border-radius:24px;font-size:.76rem;
  font-family:var(--font-body);font-weight:500;cursor:pointer;
  transition:all .25s ease;display:flex;align-items:center;gap:5px;
  background:var(--white);color:var(--warm-gray);letter-spacing:.02em;
}
.filter-btn:hover{transform:translateY(-1px);box-shadow:0 3px 10px rgba(0,0,0,.08);border-color:var(--ocean)}
.filter-btn.active{color:#fff;transform:translateY(-1px);box-shadow:0 3px 12px rgba(0,0,0,.15);border-color:transparent}
.filter-btn.active[data-cat="all"]{background:var(--ocean)}
.filter-btn.active[data-cat="beach"]{background:var(--beach-blue)}
.filter-btn.active[data-cat="restaurant"]{background:var(--restaurant-terra)}
.filter-btn.active[data-cat="hiking"]{background:var(--hike-green)}
.filter-btn.active[data-cat="attraction"]{background:var(--attraction-purple)}
.filter-count{
  font-size:.65rem;background:rgba(255,255,255,.3);
  padding:1px 6px;border-radius:8px;min-width:18px;text-align:center;
}

/* ‚îÄ‚îÄ POI LIST ‚îÄ‚îÄ */
.poi-list{flex:1;overflow-y:auto;padding:8px 14px 100px;scroll-behavior:smooth}
.poi-list::-webkit-scrollbar{width:5px}
.poi-list::-webkit-scrollbar-thumb{background:var(--sand-dark);border-radius:4px}

.poi-card{
  padding:14px 16px;border-radius:14px;cursor:pointer;
  transition:all .25s ease;margin-bottom:8px;
  border:2px solid transparent;position:relative;
  display:flex;align-items:flex-start;gap:12px;
  background:var(--driftwood-light);
}
.poi-card:hover{
  background:var(--ocean-light);border-color:var(--ocean);
  transform:translateX(3px);
}
.poi-card.active-card{
  background:var(--ocean-light);border-color:var(--ocean);
  box-shadow:0 2px 12px rgba(58,156,191,.18);
}
.poi-icon{
  width:40px;height:40px;border-radius:12px;display:flex;
  align-items:center;justify-content:center;flex-shrink:0;
  font-size:.95rem;color:#fff;
}
.poi-icon.beach{background:var(--beach-blue)}
.poi-icon.restaurant{background:var(--restaurant-terra)}
.poi-icon.hiking{background:var(--hike-green)}
.poi-icon.attraction{background:var(--attraction-purple)}
.poi-info{min-width:0}
.poi-name{
  font-weight:600;font-size:.88rem;line-height:1.2;
  color:var(--charcoal);margin-bottom:3px;
}
.poi-snippet{
  font-size:.75rem;color:var(--warm-gray);line-height:1.35;
  display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;
}
.poi-distance{
  font-size:.68rem;color:var(--ocean);font-weight:600;margin-top:4px;
  display:flex;align-items:center;gap:4px;
}

/* ‚îÄ‚îÄ TIPS SECTION ‚îÄ‚îÄ */
.tips-section{
  flex-shrink:0;padding:14px 18px;
  background:var(--sand);border-top:2px dashed var(--sand-dark);
  position:relative;z-index:2;
}
.tips-toggle{
  font-size:.78rem;font-weight:600;color:var(--ocean-deep);cursor:pointer;
  display:flex;align-items:center;gap:6px;border:none;background:none;
  font-family:var(--font-body);width:100%;
}
.tips-toggle i.chevron{transition:transform .3s ease;font-size:.65rem}
.tips-toggle i.chevron.open{transform:rotate(180deg)}
.tips-content{
  max-height:0;overflow:hidden;transition:max-height .4s ease;
}
.tips-content.open{max-height:300px}
.tips-content ul{
  list-style:none;padding:10px 0 2px;font-size:.73rem;color:var(--warm-gray);line-height:1.7;
}
.tips-content li{padding-left:18px;position:relative}
.tips-content li::before{
  content:'\f3c5';font-family:'Font Awesome 6 Free';font-weight:900;
  position:absolute;left:0;color:var(--ocean);font-size:.6rem;top:2px;
}

/* ‚îÄ‚îÄ TOGGLE BUTTON ‚îÄ‚îÄ */
.sidebar-toggle{
  position:fixed;top:16px;left:16px;z-index:1001;
  width:44px;height:44px;border-radius:12px;border:none;
  background:var(--white);box-shadow:0 2px 16px rgba(0,0,0,.18);
  cursor:pointer;display:flex;align-items:center;justify-content:center;
  font-size:1.1rem;color:var(--ocean-deep);
  transition:all .3s ease;
}
.sidebar-toggle:hover{transform:scale(1.05);box-shadow:0 4px 20px rgba(0,0,0,.22)}
.sidebar-toggle.shifted{left:calc(var(--sidebar-w) + 16px)}

/* ‚îÄ‚îÄ MAP OVERRIDES ‚îÄ‚îÄ */
.leaflet-popup-content-wrapper{
  border-radius:14px!important;box-shadow:0 8px 32px rgba(0,0,0,.18)!important;
  padding:0!important;overflow:hidden;border:none!important;
}
.leaflet-popup-content{margin:0!important;min-width:260px;max-width:300px}
.leaflet-popup-tip{box-shadow:0 4px 12px rgba(0,0,0,.12)!important}

.popup-inner{font-family:var(--font-body)}
.popup-img{
  width:100%;height:140px;object-fit:cover;display:block;
}
.popup-header{
  padding:16px 18px 12px;position:relative;
}
.popup-header.beach{background:linear-gradient(135deg,#e3f2fd,#bbdefb)}
.popup-header.restaurant{background:linear-gradient(135deg,#fbe9e7,#ffccbc)}
.popup-header.hiking{background:linear-gradient(135deg,#e8f5e9,#c8e6c9)}
.popup-header.attraction{background:linear-gradient(135deg,#f3e5f5,#e1bee7)}
.popup-cat-tag{
  display:inline-flex;align-items:center;gap:4px;
  font-size:.65rem;font-weight:700;text-transform:uppercase;
  letter-spacing:.06em;padding:3px 10px;border-radius:20px;
  color:#fff;margin-bottom:8px;
}
.popup-cat-tag.beach{background:var(--beach-blue)}
.popup-cat-tag.restaurant{background:var(--restaurant-terra)}
.popup-cat-tag.hiking{background:var(--hike-green)}
.popup-cat-tag.attraction{background:var(--attraction-purple)}
.popup-title{
  font-family:var(--font-display);font-size:1.15rem;font-weight:700;
  color:var(--charcoal);line-height:1.2;
}
.popup-body{padding:12px 18px 16px}
.popup-desc{font-size:.8rem;line-height:1.55;color:var(--warm-gray)}
.popup-meta{
  margin-top:10px;display:flex;align-items:center;gap:6px;
  font-size:.72rem;color:var(--ocean);font-weight:600;
}

/* ‚îÄ‚îÄ CUSTOM MARKERS ‚îÄ‚îÄ */
.custom-marker{
  display:flex;align-items:center;justify-content:center;
  border-radius:50% 50% 50% 0;transform:rotate(-45deg);
  box-shadow:0 3px 14px rgba(0,0,0,.4);
  border:2.5px solid #fff;transition:transform .2s ease;
}
.custom-marker i{transform:rotate(45deg);color:#fff;font-size:13px}
.custom-marker:hover{transform:rotate(-45deg) scale(1.15)}

.home-marker{
  width:48px;height:48px;border-radius:50%;
  background:var(--ocean-deep);border:3px solid #fff;
  display:flex;align-items:center;justify-content:center;
  box-shadow:0 0 0 0 rgba(14,74,94,.4);
  animation:homePulse 2.5s ease-in-out infinite;
}
.home-marker i{color:#fff;font-size:20px}

@keyframes homePulse{
  0%{box-shadow:0 0 0 0 rgba(14,74,94,.45)}
  50%{box-shadow:0 0 0 18px rgba(14,74,94,0)}
  100%{box-shadow:0 0 0 0 rgba(14,74,94,0)}
}

/* ‚îÄ‚îÄ ROUTE LABELS ‚îÄ‚îÄ */
.route-label{
  background:rgba(255,255,255,.92);backdrop-filter:blur(4px);
  padding:5px 11px;border-radius:8px;font-family:var(--font-body);
  font-size:.72rem;font-weight:600;color:var(--ocean-deep);
  box-shadow:0 2px 8px rgba(0,0,0,.12);white-space:nowrap;
  border:1px solid rgba(26,107,138,.2);
}

/* ‚îÄ‚îÄ WELCOME OVERLAY ‚îÄ‚îÄ */
.welcome-overlay{
  position:fixed;inset:0;z-index:2000;
  background:linear-gradient(180deg,#87ceeb 0%,#5bb8d4 35%,#3a9cbf 60%,#1f7a9a 100%);
  display:flex;align-items:center;justify-content:center;flex-direction:column;
  opacity:1;transition:opacity .8s ease;pointer-events:all;
  overflow:hidden;
}
.welcome-overlay.hide{opacity:0;pointer-events:none}

/* Sun */
.welcome-sun{
  position:absolute;top:8%;right:12%;width:120px;height:120px;
  border-radius:50%;background:radial-gradient(circle,#ffe082 30%,#ffca28 70%,rgba(255,202,40,0) 100%);
  box-shadow:0 0 80px 30px rgba(255,202,40,.35);
  animation:sunGlow 4s ease-in-out infinite;
}
@keyframes sunGlow{0%,100%{box-shadow:0 0 80px 30px rgba(255,202,40,.35)}50%{box-shadow:0 0 100px 40px rgba(255,202,40,.5)}}

/* Clouds */
.welcome-cloud{position:absolute;opacity:.7}
.welcome-cloud svg{fill:#fff;filter:drop-shadow(0 2px 4px rgba(0,0,0,.05))}
.cloud-1{top:12%;left:5%;animation:cloudDrift 25s linear infinite}
.cloud-2{top:20%;left:55%;animation:cloudDrift 35s linear infinite;opacity:.5;transform:scale(.7)}
.cloud-3{top:8%;left:30%;animation:cloudDrift 30s linear infinite;opacity:.4;transform:scale(.5)}
@keyframes cloudDrift{0%{transform:translateX(0)}100%{transform:translateX(100vw)}}

.welcome-content{
  text-align:center;color:var(--charcoal);max-width:560px;padding:30px;
  position:relative;z-index:10;
  background:rgba(253,250,246,.88);backdrop-filter:blur(12px);
  border-radius:24px;border:3px solid var(--sand-dark);
  box-shadow:0 12px 60px rgba(0,0,0,.12);
  margin-bottom:80px;
}
.welcome-badge{
  display:inline-block;font-size:.7rem;font-weight:600;text-transform:uppercase;
  letter-spacing:.12em;color:var(--ocean);background:var(--ocean-light);
  padding:5px 16px;border-radius:20px;margin-bottom:16px;
  font-family:var(--font-body);
}
.welcome-content h1{
  font-family:var(--font-display);font-size:clamp(1.8rem,5vw,2.8rem);
  font-weight:700;line-height:1.15;margin-bottom:8px;color:var(--charcoal);
}
.welcome-content h1 em{font-style:italic;color:var(--ocean-deep)}
.welcome-subtitle{
  font-size:1rem;color:var(--driftwood);line-height:1.6;margin-bottom:8px;
  font-weight:400;
}
.welcome-features{
  display:flex;justify-content:center;gap:24px;margin:20px 0 24px;
  flex-wrap:wrap;
}
.welcome-feat{
  display:flex;flex-direction:column;align-items:center;gap:6px;
  font-size:.72rem;color:var(--warm-gray);font-weight:500;
}
.welcome-feat-icon{
  width:48px;height:48px;border-radius:14px;display:flex;
  align-items:center;justify-content:center;font-size:1.1rem;color:#fff;
}
.welcome-btn{
  border:none;padding:16px 44px;border-radius:30px;
  background:var(--ocean);color:#fff;
  font-family:var(--font-body);font-size:1rem;font-weight:600;
  cursor:pointer;transition:all .3s ease;
  box-shadow:0 4px 20px rgba(58,156,191,.35);letter-spacing:.02em;
}
.welcome-btn:hover{transform:translateY(-2px) scale(1.03);box-shadow:0 8px 30px rgba(58,156,191,.5);background:var(--ocean-deep)}

/* Beach / Sand bottom */
.welcome-beach{
  position:absolute;bottom:0;left:0;right:0;height:140px;z-index:5;
}
.welcome-sand{
  position:absolute;bottom:0;left:0;right:0;height:60px;
  background:linear-gradient(180deg,#e8d5b5,#dcc9a3);
}
.welcome-sand::before{
  content:'';position:absolute;top:0;left:0;right:0;height:8px;
  background:repeating-linear-gradient(90deg,transparent 0,transparent 20px,rgba(255,255,255,.3) 20px,rgba(255,255,255,.3) 22px);
}
.welcome-wave{
  position:absolute;bottom:55px;left:0;right:0;height:50px;overflow:hidden;
}
.welcome-wave svg{
  position:absolute;bottom:0;width:200%;
  animation:waveSlide 6s linear infinite;
}
.welcome-wave2{
  position:absolute;bottom:48px;left:0;right:0;height:50px;overflow:hidden;
}
.welcome-wave2 svg{
  position:absolute;bottom:0;width:200%;
  animation:waveSlide 8s linear infinite reverse;
}
@keyframes waveSlide{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}

/* ‚îÄ‚îÄ ZOOM CONTROLS ‚îÄ‚îÄ */
.leaflet-control-zoom a{
  background:var(--white)!important;color:var(--ocean-deep)!important;
  font-weight:700!important;border-radius:10px!important;
  width:36px!important;height:36px!important;line-height:36px!important;
  box-shadow:0 2px 8px rgba(0,0,0,.12)!important;
}
.leaflet-control-zoom{border:none!important;border-radius:12px!important;overflow:hidden;box-shadow:0 2px 12px rgba(0,0,0,.15)!important}

/* ‚îÄ‚îÄ LOADING SKELETONS ‚îÄ‚îÄ */
.loading-card{
  height:60px;border-radius:12px;margin-bottom:6px;
  background:linear-gradient(90deg,var(--sand) 25%,var(--sand-dark) 50%,var(--sand) 75%);
  background-size:200%;animation:shimmer 1.5s infinite;
}
@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}

/* ‚îÄ‚îÄ MOBILE ‚îÄ‚îÄ */
@media(max-width:768px){
  :root{--sidebar-w:100vw}
  .sidebar{position:fixed;top:0;left:0;height:100%;width:100%;max-width:380px}
  .sidebar.collapsed{transform:translateX(-100%)}
  .sidebar-toggle{left:12px;top:12px}
  .sidebar-toggle.shifted{left:calc(min(100vw, 380px) + 12px)}
  .sidebar-header h1{font-size:1.35rem}
}

/* ‚îÄ‚îÄ WEATHER WIDGET ‚îÄ‚îÄ */
.weather-widget{
  position:fixed;top:16px;right:16px;z-index:1001;
  background:rgba(253,250,246,.92);backdrop-filter:blur(12px);
  border-radius:16px;padding:14px 18px;min-width:180px;
  box-shadow:0 4px 24px rgba(0,0,0,.15);
  border:2px solid var(--sand-dark);
  font-family:var(--font-body);
  transition:all .3s ease;
}
.weather-widget:hover{box-shadow:0 6px 30px rgba(0,0,0,.2);transform:translateY(-1px)}
.weather-top{display:flex;align-items:center;gap:10px;margin-bottom:6px}
.weather-temp{font-family:var(--font-display);font-size:1.6rem;font-weight:700;color:var(--charcoal);line-height:1}
.weather-icon{font-size:1.8rem;line-height:1}
.weather-desc{font-size:.72rem;color:var(--warm-gray);font-weight:500;text-transform:capitalize}
.weather-details{
  display:flex;gap:12px;margin-top:8px;padding-top:8px;
  border-top:1px dashed var(--sand-dark);font-size:.68rem;color:var(--warm-gray);
}
.weather-detail{display:flex;align-items:center;gap:4px}
.weather-detail i{color:var(--ocean);font-size:.7rem}
.weather-loc{font-size:.6rem;color:var(--driftwood);margin-top:6px}
.weather-loading{font-size:.78rem;color:var(--warm-gray);padding:4px 0}

@media(max-width:768px){
  .weather-widget{top:auto;bottom:16px;right:12px;left:auto;padding:10px 14px;min-width:160px}
  .weather-temp{font-size:1.3rem}
  .weather-icon{font-size:1.4rem}
}

/* ‚îÄ‚îÄ ATTRIBUTION ‚îÄ‚îÄ */
.leaflet-control-attribution{
  font-size:.6rem!important;background:rgba(255,255,255,.8)!important;
  backdrop-filter:blur(4px);border-radius:6px 0 0 0!important;
  padding:2px 8px!important;
}
</style>
</head>
<body>

<!-- Welcome Overlay -->
<div class="welcome-overlay" id="welcome">
  <div class="welcome-sun"></div>
  <div class="welcome-cloud cloud-1"><svg width="140" height="50" viewBox="0 0 140 50"><ellipse cx="70" cy="30" rx="60" ry="20"/><ellipse cx="45" cy="22" rx="35" ry="18"/><ellipse cx="95" cy="22" rx="35" ry="18"/></svg></div>
  <div class="welcome-cloud cloud-2"><svg width="140" height="50" viewBox="0 0 140 50"><ellipse cx="70" cy="30" rx="60" ry="20"/><ellipse cx="45" cy="22" rx="35" ry="18"/><ellipse cx="95" cy="22" rx="35" ry="18"/></svg></div>
  <div class="welcome-cloud cloud-3"><svg width="140" height="50" viewBox="0 0 140 50"><ellipse cx="70" cy="30" rx="60" ry="20"/><ellipse cx="45" cy="22" rx="35" ry="18"/><ellipse cx="95" cy="22" rx="35" ry="18"/></svg></div>

  <div class="welcome-content">
    <div class="welcome-badge">Your Airbnb Guest Guide</div>
    <h1>Welcome to<br><em>Kaiser Villa</em></h1>
    <p class="welcome-subtitle">Everything you need for an amazing stay on the Opatija Riviera</p>
    <div class="welcome-features">
      <div class="welcome-feat">
        <div class="welcome-feat-icon" style="background:var(--beach-blue)"><i class="fa-solid fa-umbrella-beach"></i></div>
        7 Beaches
      </div>
      <div class="welcome-feat">
        <div class="welcome-feat-icon" style="background:var(--restaurant-terra)"><i class="fa-solid fa-utensils"></i></div>
        7 Restaurants
      </div>
      <div class="welcome-feat">
        <div class="welcome-feat-icon" style="background:var(--hike-green)"><i class="fa-solid fa-person-hiking"></i></div>
        5 Hikes
      </div>
      <div class="welcome-feat">
        <div class="welcome-feat-icon" style="background:var(--attraction-purple)"><i class="fa-solid fa-landmark"></i></div>
        7 Sights
      </div>
    </div>
    <button class="welcome-btn" onclick="dismissWelcome()">
      <i class="fa-solid fa-map-location-dot"></i>&ensp;Explore the Map
    </button>
  </div>

  <div class="welcome-beach">
    <div class="welcome-wave2">
      <svg viewBox="0 0 2880 60" preserveAspectRatio="none" fill="rgba(58,156,191,.25)">
        <path d="M0,25 C360,55 720,5 1080,35 C1440,55 1800,15 2160,35 C2520,55 2880,5 2880,35 L2880,60 L0,60Z"/>
      </svg>
    </div>
    <div class="welcome-wave">
      <svg viewBox="0 0 2880 60" preserveAspectRatio="none" fill="rgba(58,156,191,.5)">
        <path d="M0,30 C360,55 720,10 1080,35 C1440,55 1800,10 2160,35 C2520,55 2880,10 2880,35 L2880,60 L0,60Z"/>
      </svg>
    </div>
    <div class="welcome-sand"></div>
  </div>
</div>

<!-- Weather Widget -->
<div class="weather-widget" id="weatherWidget">
  <div class="weather-loading"><i class="fa-solid fa-spinner fa-spin"></i> Loading weather...</div>
</div>

<!-- Sidebar Toggle -->
<button class="sidebar-toggle shifted" id="sidebarToggle" onclick="toggleSidebar()" title="Toggle sidebar">
  <i class="fa-solid fa-xmark"></i>
</button>

<div class="app">
  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="header-deco"><i class="fa-solid fa-sun"></i></div>
      <h1>Kaiser Villa Guide</h1>
      <p>Your guide to things to do around the Airbnb</p>
    </div>

    <div class="filters" id="filters">
      <button class="filter-btn active" data-cat="all" onclick="filterPOIs('all')">
        <i class="fa-solid fa-border-all"></i> All <span class="filter-count" id="count-all"></span>
      </button>
      <button class="filter-btn" data-cat="beach" onclick="filterPOIs('beach')">
        <i class="fa-solid fa-umbrella-beach"></i> Beaches <span class="filter-count" id="count-beach"></span>
      </button>
      <button class="filter-btn" data-cat="restaurant" onclick="filterPOIs('restaurant')">
        <i class="fa-solid fa-utensils"></i> Dining <span class="filter-count" id="count-restaurant"></span>
      </button>
      <button class="filter-btn" data-cat="hiking" onclick="filterPOIs('hiking')">
        <i class="fa-solid fa-person-hiking"></i> Hikes <span class="filter-count" id="count-hiking"></span>
      </button>
      <button class="filter-btn" data-cat="attraction" onclick="filterPOIs('attraction')">
        <i class="fa-solid fa-landmark"></i> Sights <span class="filter-count" id="count-attraction"></span>
      </button>
    </div>

    <div class="poi-list" id="poiList"></div>

    <div class="tips-section">
      <button class="tips-toggle" onclick="toggleTips()">
        <i class="fa-solid fa-lightbulb"></i>
        Getting Around Tips
        <i class="fa-solid fa-chevron-down chevron" id="tipsChevron" style="margin-left:auto"></i>
      </button>
      <div class="tips-content" id="tipsContent">
        <ul>
          <li>Brsec Beach is a 1km steep walk down from parking -- wear good shoes &amp; bring water</li>
          <li>The Lungomare coastal walk is flat and easy -- perfect for any fitness level</li>
          <li>Bus line 32 connects Opatija to Moscenicka Draga along the coast</li>
          <li>Most beaches are pebble -- bring water shoes for comfort</li>
          <li>Restaurants fill up fast in summer -- book Plavi Podrum and Zijavica in advance</li>
          <li>For Vojak summit, start early morning for the clearest views</li>
        </ul>
      </div>
    </div>
  </aside>

  <!-- Map -->
  <div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// ‚îÄ‚îÄ DATA ‚îÄ‚îÄ
const HOME = { lat: 45.163, lng: 14.219, name: 'Your Accommodation', address: 'Stepca 45, Zagore' };

const POIS = [
  // BEACHES
  { id: 'b0', name: 'Stupova Beach', cat: 'beach', lat: 45.153744, lng: 14.226576, icon: 'fa-umbrella-beach',
    desc: 'Your nearest beach! A beautiful secluded cove just south of Zagore. Rocky coastline with crystal-clear Adriatic water. Perfect for a quick swim on a hot day.',
    distance: '~1.5km walk from home',
    img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/b/bb/Kvarner_bay.jpg/600px-Kvarner_bay.jpg' },
  { id: 'b1', name: 'Brsec Beach (Klancac)', cat: 'beach', lat: 45.1837, lng: 14.2443, icon: 'fa-umbrella-beach',
    desc: 'Hidden gem under dramatic cliffs. 300m pebble beach with crystal-clear water. One of Croatia\'s most beautiful secret beaches. No facilities -- bring supplies! 1km steep path from parking.',
    distance: '~4km drive + 1km walk',
    img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/d/d3/Brsec-Kvarner1.jpg/600px-Brsec-Kvarner1.jpg' },
  { id: 'b2', name: 'Sipar Beach', cat: 'beach', lat: 45.237, lng: 14.254, icon: 'fa-umbrella-beach',
    desc: 'Largest beach in Moscenicka Draga. Blue Flag certified. Beautiful pebbles with full facilities including showers, cafes, and rentals.',
    distance: '~10km, 15 min drive',
    img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/43/HR-PG-Mo%C5%A1%C4%87eni%C4%8Dka_Draga03.jpg/600px-HR-PG-Mo%C5%A1%C4%87eni%C4%8Dka_Draga03.jpg' },
  { id: 'b3', name: 'Sveti Ivan Beach', cat: 'beach', lat: 45.225, lng: 14.255, icon: 'fa-umbrella-beach',
    desc: 'Ranked 37th most beautiful beach in Europe! Named after a charming 1628 church right on the beach edge.',
    distance: '~9km, 13 min drive',
    img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/f/fb/Mo%C5%A1%C4%87eni%C4%8Dka_Draga_-_pla%C5%BEa.jpg/600px-Mo%C5%A1%C4%87eni%C4%8Dka_Draga_-_pla%C5%BEa.jpg' },
  { id: 'b4', name: 'Uboka Bay', cat: 'beach', lat: 45.2147, lng: 14.2476, icon: 'fa-umbrella-beach',
    desc: 'Wild, secluded cove between Moscenicka Draga and Brsec. A real insider tip for those wanting privacy and untouched nature.',
    distance: '~7km, 12 min drive',
    img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/8e/Croatie_Moscenicka_Draga_Plage_13082008_-_panoramio.jpg/600px-Croatie_Moscenicka_Draga_Plage_13082008_-_panoramio.jpg' },
  { id: 'b5', name: 'Medveja Beach', cat: 'beach', lat: 45.2691, lng: 14.2683, icon: 'fa-umbrella-beach',
    desc: '400m pebble beach near Lovran surrounded by pine forest. Full facilities. Great for families.',
    distance: '~18km, 22 min drive',
    img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/c/c2/Medveja_-_pla%C5%BEa.jpg/600px-Medveja_-_pla%C5%BEa.jpg' },
  { id: 'b6', name: 'Slatina Beach', cat: 'beach', lat: 45.3331, lng: 14.3046, icon: 'fa-umbrella-beach',
    desc: 'Opatija\'s main beach. Blue Flag certified. 400m with all amenities, restaurants, and nightlife nearby.',
    distance: '~25km, 30 min drive',
    img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/f/f6/Opatija_-_pla%C5%BEe.jpg/600px-Opatija_-_pla%C5%BEe.jpg' },

  // RESTAURANTS
  { id: 'r1', name: 'Konoba Zijavica', cat: 'restaurant', lat: 45.231, lng: 14.247, icon: 'fa-utensils',
    desc: 'Michelin recommended! Beachfront in Moscenicka Draga. Famous for fresh daily catch and scampi. JRE member.',
    distance: '~10km, 14 min drive', tag: 'Michelin',
    img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/2b/MoscenickaDraga1.jpg/600px-MoscenickaDraga1.jpg' },
  { id: 'r2', name: 'Johnson', cat: 'restaurant', lat: 45.238, lng: 14.249, icon: 'fa-utensils',
    desc: 'Michelin selected. Charming family house above Moscenicka Draga. 60 years of culinary tradition.',
    distance: '~10km, 15 min drive', tag: 'Michelin',
    img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/HR-PG-Mo%C5%A1%C4%87eni%C4%8Dka_Draga01.jpg/600px-HR-PG-Mo%C5%A1%C4%87eni%C4%8Dka_Draga01.jpg' },
  { id: 'r3', name: 'Konoba Pescaria', cat: 'restaurant', lat: 45.232, lng: 14.248, icon: 'fa-utensils',
    desc: 'Harbour-side in Moscenicka Draga. Excellent Mediterranean seafood in a casual setting.',
    distance: '~10km, 14 min drive',
    img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/2b/MoscenickaDraga1.jpg/600px-MoscenickaDraga1.jpg' },
  { id: 'r4', name: 'Konoba Slamnjaki', cat: 'restaurant', lat: 45.235, lng: 14.248, icon: 'fa-utensils',
    desc: 'Hilltop terrace near Sv. Jelena. Amazing views and great value for money.',
    distance: '~10km, 14 min drive',
    img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/HR-PG-Mo%C5%A1%C4%87eni%C4%8Dka_Draga01.jpg/600px-HR-PG-Mo%C5%A1%C4%87eni%C4%8Dka_Draga01.jpg' },
  { id: 'r5', name: 'Bevanda', cat: 'restaurant', lat: 45.337, lng: 14.305, icon: 'fa-utensils',
    desc: '5-star fine dining on Opatija waterfront. Stunning sea views. Special occasion worthy.',
    distance: '~25km, 30 min drive', tag: 'Fine Dining',
    img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/5e/Opatija_-_Riva_-_panoramio.jpg/600px-Opatija_-_Riva_-_panoramio.jpg' },
  { id: 'r6', name: 'Plavi Podrum', cat: 'restaurant', lat: 45.348, lng: 14.320, icon: 'fa-utensils',
    desc: 'Twice on World\'s 100 Best Restaurants list! In charming Volosko fishing village. A must-visit.',
    distance: '~28km, 33 min drive', tag: 'World Top 100',
    img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/2b/06.volosko.jpg/600px-06.volosko.jpg' },
  { id: 'r7', name: 'Pansion Ucka', cat: 'restaurant', lat: 45.292, lng: 14.192, icon: 'fa-utensils',
    desc: 'Mountain restaurant at Poklon Pass (920m altitude). Famous for game dishes and mountain air.',
    distance: '~20km, 30 min drive',
    img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/22/Info-centar.jpg/600px-Info-centar.jpg' },

  // HIKING
  { id: 'h1', name: 'Lungomare (Start - Volosko)', cat: 'hiking', lat: 45.348, lng: 14.319, icon: 'fa-person-hiking',
    desc: 'Start of Croatia\'s most famous coastal walk. 12km along the sea from Volosko to Lovran. Easy, flat, stunning.',
    distance: '~28km drive to start',
    img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/6a/Lungomare-Opatija.jpg/600px-Lungomare-Opatija.jpg' },
  { id: 'h2', name: 'Lungomare (End - Lovran)', cat: 'hiking', lat: 45.291, lng: 14.270, icon: 'fa-person-hiking',
    desc: 'Southern end of the Lungomare. The walk takes 3-4 hours one way. Take the bus back!',
    distance: '~17km drive to start',
    img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/6a/Lungomare-Opatija.jpg/600px-Lungomare-Opatija.jpg' },
  { id: 'h3', name: 'Poklon Pass (Ucka Park)', cat: 'hiking', lat: 45.292, lng: 14.192, icon: 'fa-person-hiking',
    desc: 'Gateway to Ucka Nature Park. Visitor center and start of the trail to Vojak summit.',
    distance: '~20km, 30 min drive',
    img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/22/Info-centar.jpg/600px-Info-centar.jpg' },
  { id: 'h4', name: 'Vojak Summit (1,401m)', cat: 'hiking', lat: 45.285, lng: 14.202, icon: 'fa-mountain-sun',
    desc: 'Highest peak in Istria at 1,401m! 1911 observation tower with views all the way to the Alps on clear days.',
    distance: '~3.5h hike from Poklon',
    img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/0/0f/Croatia_U%C4%8Dka_Mountaintop.jpg/600px-Croatia_U%C4%8Dka_Mountaintop.jpg' },
  { id: 'h5', name: '753 Steps (Moscenice)', cat: 'hiking', lat: 45.2264, lng: 14.2536, icon: 'fa-stairs',
    desc: 'Historic stone stairway connecting medieval Moscenice village to the coast. A unique cultural hike.',
    distance: '~8km, 12 min drive',
    img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/e4/Moscenice_0709_1.jpg/600px-Moscenice_0709_1.jpg' },

  // ATTRACTIONS
  { id: 'a1', name: 'Maiden with the Seagull', cat: 'attraction', lat: 45.3335, lng: 14.3060, icon: 'fa-camera',
    desc: 'Opatija\'s most iconic statue (1956). The most photographed spot on the entire Riviera.',
    distance: '~25km, 30 min drive',
    img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/ee/Djevojka_s_galebom_%28Maiden_with_the_seagull%29.jpg/600px-Djevojka_s_galebom_%28Maiden_with_the_seagull%29.jpg' },
  { id: 'a2', name: 'Villa Angiolina & Park', cat: 'attraction', lat: 45.3357, lng: 14.3120, icon: 'fa-tree',
    desc: 'Beautiful 1844 villa housing the Croatian Tourism Museum. Park has 150+ exotic plant species.',
    distance: '~25km, 30 min drive',
    img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/54/Vila_Angiolina_s_perivojem_Z-6727.jpg/600px-Vila_Angiolina_s_perivojem_Z-6727.jpg' },
  { id: 'a3', name: 'Moscenice Village', cat: 'attraction', lat: 45.2264, lng: 14.2536, icon: 'fa-landmark',
    desc: 'Perfectly preserved medieval hilltop village. Ethnographic museum and traditional olive mill.',
    distance: '~8km, 12 min drive',
    img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/e4/Moscenice_0709_1.jpg/600px-Moscenice_0709_1.jpg' },
  { id: 'a4', name: 'Brsec Village', cat: 'attraction', lat: 45.183, lng: 14.230, icon: 'fa-landmark',
    desc: 'Medieval hilltop village with ancient Glagolitic inscriptions. Hosts a Blues Festival!',
    distance: '~3km, 5 min drive',
    img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/93/Brsec_Istria.jpg/600px-Brsec_Istria.jpg' },
  { id: 'a5', name: 'Volosko', cat: 'attraction', lat: 45.348, lng: 14.319, icon: 'fa-palette',
    desc: 'Charming fishing village turned gourmet capital. Wander narrow streets and discover art galleries.',
    distance: '~28km, 33 min drive',
    img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/51/07.Volosko.jpg/600px-07.Volosko.jpg' },
  { id: 'a6', name: 'Lovran Old Town', cat: 'attraction', lat: 45.2917, lng: 14.2700, icon: 'fa-chess-rook',
    desc: 'Medieval walled town. Don\'t miss the famous Chestnut Festival in October.',
    distance: '~17km, 20 min drive',
    img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Croatia_BW_2014-10-10_15-06-52.jpg/600px-Croatia_BW_2014-10-10_15-06-52.jpg' },
  { id: 'a7', name: 'Ljubo de Karina Gallery', cat: 'attraction', lat: 45.170, lng: 14.220, icon: 'fa-palette',
    desc: 'Open-air sculpture park right in Zagore by renowned Croatian sculptor. Walking distance from your accommodation!',
    distance: '~800m walk',
    img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/b/bb/Kvarner_bay.jpg/600px-Kvarner_bay.jpg' },
];

const CAT_COLORS = {
  beach: '#42a5c5',
  restaurant: '#d4845a',
  hiking: '#6d8c5e',
  attraction: '#8b6baf'
};

const CAT_ICONS = {
  beach: 'fa-umbrella-beach',
  restaurant: 'fa-utensils',
  hiking: 'fa-person-hiking',
  attraction: 'fa-landmark'
};

// ‚îÄ‚îÄ MAP INIT ‚îÄ‚îÄ
const map = L.map('map', {
  center: [45.26, 14.27],
  zoom: 12,
  zoomControl: false,
  attributionControl: true
});

L.control.zoom({ position: 'bottomright' }).addTo(map);

const satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
  attribution: '&copy; Esri, Maxar, Earthstar Geographics',
  maxZoom: 19
});
const labels = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_only_labels/{z}/{x}/{y}{r}.png', {
  subdomains: 'abcd', maxZoom: 19, pane: 'overlayPane'
});
satellite.addTo(map);
labels.addTo(map);

// ‚îÄ‚îÄ MARKERS ‚îÄ‚îÄ
function createMarkerIcon(cat, iconClass) {
  const color = CAT_COLORS[cat];
  return L.divIcon({
    className: '',
    html: `<div class="custom-marker" style="width:34px;height:34px;background:${color}"><i class="fa-solid ${iconClass}"></i></div>`,
    iconSize: [34, 34],
    iconAnchor: [17, 34],
    popupAnchor: [0, -36]
  });
}

const homeIcon = L.divIcon({
  className: '',
  html: '<div class="home-marker"><i class="fa-solid fa-house"></i></div>',
  iconSize: [48, 48],
  iconAnchor: [24, 24],
  popupAnchor: [0, -28]
});

// Home marker
const homeMarker = L.marker([HOME.lat, HOME.lng], { icon: homeIcon, zIndexOffset: 1000 })
  .addTo(map)
  .bindPopup(`
    <div class="popup-inner">
      <div class="popup-header" style="background:linear-gradient(135deg,#e0f2f1,#b2dfdb)">
        <span class="popup-cat-tag" style="background:var(--ocean-deep)"><i class="fa-solid fa-house"></i>&ensp;Home Base</span>
        <div class="popup-title">${HOME.name}</div>
      </div>
      <div class="popup-body">
        <div class="popup-desc">${HOME.address}<br><br>This is where you're staying! All distances on this map are measured from here.</div>
      </div>
    </div>
  `);

// POI markers
const markers = {};
const markerLayers = L.layerGroup().addTo(map);

POIS.forEach(poi => {
  const marker = L.marker([poi.lat, poi.lng], {
    icon: createMarkerIcon(poi.cat, poi.icon || CAT_ICONS[poi.cat])
  });

  const tagHtml = poi.tag ? `<span style="display:inline-block;margin-left:8px;font-size:.6rem;background:gold;color:#333;padding:1px 7px;border-radius:8px;font-weight:700">${poi.tag}</span>` : '';

  marker.bindPopup(`
    <div class="popup-inner">
      ${poi.img ? `<img class="popup-img" src="${poi.img}" alt="${poi.name}" loading="lazy" onerror="this.style.display='none'">` : ''}
      <div class="popup-header ${poi.cat}">
        <span class="popup-cat-tag ${poi.cat}"><i class="fa-solid ${CAT_ICONS[poi.cat]}"></i>&ensp;${poi.cat === 'restaurant' ? 'Restaurant' : poi.cat.charAt(0).toUpperCase() + poi.cat.slice(1)}</span>${tagHtml}
        <div class="popup-title">${poi.name}</div>
      </div>
      <div class="popup-body">
        <div class="popup-desc">${poi.desc}</div>
        ${poi.distance ? `<div class="popup-meta"><i class="fa-solid fa-route"></i> From home: ${poi.distance}</div>` : ''}
      </div>
    </div>
  `);

  marker.poiData = poi;
  markers[poi.id] = marker;
  markerLayers.addLayer(marker);
});

// ‚îÄ‚îÄ DYNAMIC ROUTE LINE ‚îÄ‚îÄ
let activeRouteLine = null;
let activeRouteLabel = null;

function showRouteTo(poi) {
  clearRoute();
  const color = CAT_COLORS[poi.cat] || '#3a9cbf';
  activeRouteLine = L.polyline(
    [[HOME.lat, HOME.lng], [poi.lat, poi.lng]],
    { color, weight: 3, opacity: 0.8, dashArray: '8, 10', lineCap: 'round' }
  ).addTo(map);
  if (poi.distance) {
    const mid = [(HOME.lat + poi.lat) / 2, (HOME.lng + poi.lng) / 2];
    activeRouteLabel = L.marker(mid, {
      icon: L.divIcon({
        className: '',
        html: `<div class="route-label"><i class="fa-solid fa-route"></i>&ensp;${poi.distance}</div>`,
        iconSize: [200, 30], iconAnchor: [100, 15]
      }),
      interactive: false
    }).addTo(map);
  }
}

function clearRoute() {
  if (activeRouteLine) { map.removeLayer(activeRouteLine); activeRouteLine = null; }
  if (activeRouteLabel) { map.removeLayer(activeRouteLabel); activeRouteLabel = null; }
}

map.on('click', clearRoute);

// ‚îÄ‚îÄ SIDEBAR LIST ‚îÄ‚îÄ
let activeFilter = 'all';

function renderList(filter) {
  const list = document.getElementById('poiList');
  const filtered = filter === 'all' ? POIS : POIS.filter(p => p.cat === filter);
  list.innerHTML = '';

  filtered.forEach((poi, i) => {
    const card = document.createElement('div');
    card.className = 'poi-card';
    card.id = `card-${poi.id}`;
    card.style.opacity = '0';
    card.style.transform = 'translateY(12px)';
    card.innerHTML = `
      <div class="poi-icon ${poi.cat}"><i class="fa-solid ${poi.icon || CAT_ICONS[poi.cat]}"></i></div>
      <div class="poi-info">
        <div class="poi-name">${poi.name}</div>
        <div class="poi-snippet">${poi.desc}</div>
        ${poi.distance ? `<div class="poi-distance"><i class="fa-solid fa-route"></i> ${poi.distance}</div>` : ''}
      </div>
    `;
    card.onclick = () => flyToPOI(poi);
    list.appendChild(card);

    setTimeout(() => {
      card.style.transition = 'opacity .35s ease, transform .35s ease';
      card.style.opacity = '1';
      card.style.transform = 'translateY(0)';
    }, 40 * i);
  });
}

function flyToPOI(poi) {
  showRouteTo(poi);
  map.flyTo([poi.lat, poi.lng], 15, { duration: 1.2 });
  markers[poi.id].openPopup();

  document.querySelectorAll('.poi-card').forEach(c => c.classList.remove('active-card'));
  const card = document.getElementById(`card-${poi.id}`);
  if (card) card.classList.add('active-card');

  // On mobile, collapse sidebar after selection
  if (window.innerWidth <= 768) {
    setTimeout(() => toggleSidebar(), 300);
  }
}

function filterPOIs(cat) {
  clearRoute();
  activeFilter = cat;
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
  document.querySelector(`[data-cat="${cat}"]`).classList.add('active');

  // Show/hide markers
  markerLayers.clearLayers();
  POIS.forEach(poi => {
    if (cat === 'all' || poi.cat === cat) {
      markerLayers.addLayer(markers[poi.id]);
    }
  });

  renderList(cat);

  // Fit bounds to visible markers
  if (cat !== 'all') {
    const visible = POIS.filter(p => p.cat === cat);
    if (visible.length) {
      const bounds = L.latLngBounds(visible.map(p => [p.lat, p.lng]));
      bounds.extend([HOME.lat, HOME.lng]);
      map.flyToBounds(bounds, { padding: [60, 60], duration: 1 });
    }
  } else {
    map.flyTo([45.26, 14.27], 12, { duration: 1 });
  }
}

// Update counts
function updateCounts() {
  document.getElementById('count-all').textContent = POIS.length;
  ['beach', 'restaurant', 'hiking', 'attraction'].forEach(cat => {
    document.getElementById(`count-${cat}`).textContent = POIS.filter(p => p.cat === cat).length;
  });
}

// ‚îÄ‚îÄ SIDEBAR TOGGLE ‚îÄ‚îÄ
let sidebarOpen = true;
function toggleSidebar() {
  sidebarOpen = !sidebarOpen;
  document.getElementById('sidebar').classList.toggle('collapsed', !sidebarOpen);
  document.getElementById('sidebarToggle').classList.toggle('shifted', sidebarOpen);
  document.getElementById('sidebarToggle').innerHTML = sidebarOpen
    ? '<i class="fa-solid fa-xmark"></i>'
    : '<i class="fa-solid fa-bars"></i>';
  setTimeout(() => map.invalidateSize(), 450);
}

// ‚îÄ‚îÄ TIPS TOGGLE ‚îÄ‚îÄ
function toggleTips() {
  const content = document.getElementById('tipsContent');
  const chevron = document.getElementById('tipsChevron');
  content.classList.toggle('open');
  chevron.classList.toggle('open');
}

// ‚îÄ‚îÄ WELCOME ‚îÄ‚îÄ
function dismissWelcome() {
  document.getElementById('welcome').classList.add('hide');
  setTimeout(() => {
    document.getElementById('welcome').style.display = 'none';
    map.invalidateSize();
    map.flyTo([HOME.lat, HOME.lng], 13, { duration: 1.5 });
    setTimeout(() => homeMarker.openPopup(), 1600);
  }, 800);
}

// ‚îÄ‚îÄ CLICK MARKER -> HIGHLIGHT CARD + SHOW ROUTE ‚îÄ‚îÄ
Object.values(markers).forEach(marker => {
  marker.on('click', () => {
    const poi = marker.poiData;
    showRouteTo(poi);
    document.querySelectorAll('.poi-card').forEach(c => c.classList.remove('active-card'));
    const card = document.getElementById(`card-${poi.id}`);
    if (card) {
      card.classList.add('active-card');
      card.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }
  });
});

// ‚îÄ‚îÄ WEATHER ‚îÄ‚îÄ
function getWeatherEmoji(code) {
  if (code === 0) return '‚òÄÔ∏è';
  if (code <= 3) return '‚õÖ';
  if (code <= 49) return 'üå´Ô∏è';
  if (code <= 59) return 'üå¶Ô∏è';
  if (code <= 69) return 'üåßÔ∏è';
  if (code <= 79) return 'üå®Ô∏è';
  if (code <= 82) return 'üåßÔ∏è';
  if (code <= 86) return 'üå®Ô∏è';
  if (code <= 99) return '‚õàÔ∏è';
  return 'üå§Ô∏è';
}

function getWeatherDesc(code) {
  if (code === 0) return 'Clear sky';
  if (code <= 3) return 'Partly cloudy';
  if (code <= 49) return 'Foggy';
  if (code <= 55) return 'Light drizzle';
  if (code <= 59) return 'Drizzle';
  if (code <= 63) return 'Light rain';
  if (code <= 69) return 'Rain';
  if (code <= 75) return 'Snow';
  if (code <= 79) return 'Snow grains';
  if (code <= 82) return 'Rain showers';
  if (code <= 86) return 'Snow showers';
  if (code <= 99) return 'Thunderstorm';
  return 'Fair';
}

async function loadWeather() {
  try {
    const resp = await fetch(
      `https://api.open-meteo.com/v1/forecast?latitude=${HOME.lat}&longitude=${HOME.lng}&current=temperature_2m,relative_humidity_2m,wind_speed_10m,weather_code&timezone=Europe%2FBerlin`
    );
    const data = await resp.json();
    const c = data.current;
    const widget = document.getElementById('weatherWidget');
    widget.innerHTML = `
      <div class="weather-top">
        <span class="weather-icon">${getWeatherEmoji(c.weather_code)}</span>
        <span class="weather-temp">${Math.round(c.temperature_2m)}¬∞C</span>
      </div>
      <div class="weather-desc">${getWeatherDesc(c.weather_code)}</div>
      <div class="weather-details">
        <span class="weather-detail"><i class="fa-solid fa-wind"></i> ${Math.round(c.wind_speed_10m)} km/h</span>
        <span class="weather-detail"><i class="fa-solid fa-droplet"></i> ${c.relative_humidity_2m}%</span>
      </div>
      <div class="weather-loc"><i class="fa-solid fa-location-dot"></i> Zagore, Opatija Riviera</div>
    `;
  } catch (e) {
    document.getElementById('weatherWidget').innerHTML =
      '<div class="weather-loading">Weather unavailable</div>';
  }
}

loadWeather();
setInterval(loadWeather, 600000); // Refresh every 10 min

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
updateCounts();
renderList('all');
</script>
</body>
</html>
